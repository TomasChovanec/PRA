<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IoT ‚Äì Teploty a Slidery (Firebase)</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f5f5f5;
      text-align: center;
      padding: 2rem;
    }
    h1, h2 { color: #333; }
    .card {
      display: inline-block;
      background: white;
      margin: 1rem;
      padding: 1.5rem 2rem;
      border-radius: 1rem;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      min-width: 180px;
    }
    .slidecontainer {
      margin: 2rem auto;
      max-width: 600px;
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }
    input[type=range] {
      width: 80%;
    }
    .slider-label {
      font-weight: bold;
      margin-top: 0.5rem;
      color: #007bff;
    }
    #errorBox {
      color: #b00;
      font-weight: 700;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>IoT ‚Äì Teploty a Ovl√°d√°n√≠ Slider≈Ø</h1>

  <!-- üîπ Sekce pro zobrazen√≠ teplot -->
  <h2>Aktu√°ln√≠ teploty</h2>
  <div id="temperatures"></div>

  <!-- üîπ Sekce pro slidery -->
  <h2>Ovl√°d√°n√≠ Slider≈Ø</h2>
  <div id="sliders"></div>

  <div id="errorBox"></div>

  <script>
    const dbURL = "https://arduino-pokus-default-rtdb.firebaseio.com";

    // === üî∏ ZOBRAZEN√ç TELOT Z FIREBASE ===
    const NUM_TEMPS = 10; // poƒçet teplotn√≠ch ƒçidel
    const tempContainer = document.getElementById("temperatures");

    for (let i = 1; i <= NUM_TEMPS; i++) {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>Temperature_${i}</h3>
        <p><span id="temp${i}">--</span> ¬∞C</p>
      `;
      tempContainer.appendChild(card);
    }

    async function readTemperatures() {
      try {
        const res = await fetch(`${dbURL}/.json`);
        if (!res.ok) throw new Error("Chyba ƒçten√≠ dat");
        const data = await res.json();

        for (let i = 1; i <= NUM_TEMPS; i++) {
          const el = document.getElementById("temp" + i);
          if (el && data && data[`Temperature_${i}`] != null) {
            el.textContent = data[`Temperature_${i}`];
          }
        }
      } catch (err) {
        showError("Chyba ƒçten√≠ teplot: " + err.message);
      }
    }

    setInterval(readTemperatures, 2000);
    readTemperatures();

    // === üî∏ OVL√ÅD√ÅN√ç SLIDER≈Æ ===
    const NUM_SLIDERS = 10;
    const sliderContainer = document.getElementById("sliders");

    for (let i = 1; i <= NUM_SLIDERS; i++) {
      const div = document.createElement("div");
      div.className = "slidecontainer";
      div.innerHTML = `
        <h3>Slider_${i}</h3>
        <input type="range" min="0" max="100" value="50" class="slider" id="slider${i}">
        <p>Aktu√°ln√≠ hodnota: <span class="slider-label" id="value${i}">50</span></p>
      `;
      sliderContainer.appendChild(div);
    }

    for (let i = 1; i <= NUM_SLIDERS; i++) {
      const slider = document.getElementById("slider" + i);
      const valEl = document.getElementById("value" + i);

      slider.addEventListener("input", () => {
        valEl.textContent = slider.value;
      });

      slider.addEventListener("change", async () => {
        const val = Number(slider.value);
        try {
          const res = await fetch(`${dbURL}/Slider_${i}.json`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(val)
          });

          if (!res.ok) {
            const txt = await res.text();
            showError(`Chyba z√°pisu Slider_${i} (${res.status}): ${txt}`);
          } else {
            console.log(`Slider_${i} -> ${val}`);
            showError("");
          }
        } catch (err) {
          showError(`Fetch selhal pro Slider_${i}: ${err.message}`);
        }
      });
    }

    function showError(msg) {
      console.error(msg);
      const box = document.getElementById("errorBox");
      if (box) box.textContent = msg;
    }
  </script>
</body>
</html>
